{% extends 'interfaz/main.html' %}

{% block content %}
  <main class="hero">
    <section class="login-card" aria-labelledby="login-title">
      <h1 id="login-title" class="titulo" style="font-size:2rem; text-shadow:none;">Iniciar sesiÃ³n</h1>

      <form method="POST" action="">
        {% csrf_token %}

        <div class="field">
          <label for="email">Correo electrÃ³nico</label>
          <input id="email" name="email" type="email" placeholder="tucorreo@ejemplo.com" required autocomplete="email">
          <div class="error" id="emailError" aria-live="polite"></div>
        </div>

        <div class="field">
          <div class="password-wrap">
            <label for="password">ContraseÃ±a</label>
            <input id="password" name="password" type="password" placeholder="ContraseÃ±a" required autocomplete="current-password">
            <button type="button" id="togglePwd" class="toggle-btn" aria-label="Mostrar contraseÃ±a">=A</button>
          </div>
          <div class="error" id="passwordError" aria-live="polite"></div>
        </div>

        <div class="row">
          <label class="checkbox">
            <input type="checkbox" id="remember"> RecuÃ©rdame
          </label>
        </div>

        <div class="row">
          <button type="submit" class="boton-morado">Iniciar sesiÃ³n</button>
        </div>

        <p class="muted" style="margin-top:12px;">Credenciales de ejemplo: <strong>equidad@visible.com</strong></p>
        <div id="formMessage" class="form-message" aria-live="polite"></div>
      </form>
    </section>
  </main>

<script>
  (function(){
    const demo = { email: 'demo@ejemplo.com', password: 'Demo1234' };

    const form = document.getElementById('loginForm');
    const email = document.getElementById('email');
    const password = document.getElementById('password');
    const emailError = document.getElementById('emailError');
    const passwordError = document.getElementById('passwordError');
    const formMessage = document.getElementById('formMessage');
    const toggle = document.getElementById('togglePwd');

    toggle.addEventListener('click', () => {
      const t = password.type === 'password' ? 'text' : 'password';
      password.type = t;
      toggle.setAttribute('aria-label', t === 'text' ? 'Ocultar contraseï¿½a' : 'Mostrar contraseï¿½a');
      toggle.textContent = t === 'text' ? '=H' : '=A';
    });

    function validate() {
      let ok = true;
      emailError.textContent = '';
      passwordError.textContent = '';
      formMessage.textContent = '';

      if (!email.value) { emailError.textContent = 'Ingrese su correo.'; ok = false; }
      else if (!/^\S+@\S+\.\S+$/.test(email.value)) { emailError.textContent = 'Correo invï¿½lido.'; ok = false; }

      if (!password.value) { passwordError.textContent = 'Ingrese su contraseï¿½a.'; ok = false; }
      else if (password.value.length < 6) { passwordError.textContent = 'La contraseï¿½a debe tener al menos 6 caracteres.'; ok = false; }

      return ok;
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      if (!validate()) return;

      // Simulaciï¿½n de autenticaciï¿½n (reemplazar por llamada a backend)
      if (email.value === demo.email && password.value === demo.password) {
        formMessage.style.color = '#b7f5c6';
        formMessage.textContent = 'Inicio de sesiï¿½n correcto. Redirigiendo...';
        if (document.getElementById('remember').checked) {
          localStorage.setItem('authUser', email.value);
        } else {
          sessionStorage.setItem('authUser', email.value);
        }
        // pequeï¿½o retardo para que el usuario vea el mensaje
        setTimeout(() => {
          window.location.href = 'pagina.html';
        }, 900);
      } else {
        formMessage.style.color = '#ffd6d6';
        formMessage.textContent = 'Correo o contraseï¿½a incorrectos.';
      }
    });

    // Si ya estï¿½ autenticado, redirigir (comodidad)
    if (localStorage.getItem('authUser') || sessionStorage.getItem('authUser')) {
      window.location.href = 'pagina.html';
    }
  })();
</script>

{% endblock %}
